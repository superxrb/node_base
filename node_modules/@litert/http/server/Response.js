"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const http = require("http");
const Exception_1 = require("./Exception");
const Errors_1 = require("./Errors");
const Core = require("./Core");
function extend(obj, name, fn) {
    obj[name] = fn;
}
extend(http.ServerResponse.prototype, "send", function (data) {
    if (this.finished) {
        throw new Exception_1.default(Errors_1.default.RESPONSE_ALREADY_CLOSED, "Response has been closed");
    }
    if (!this.headersSent) {
        this.setHeader("Content-Length", Buffer.byteLength(data));
    }
    this.end(data);
    return this;
});
extend(http.ServerResponse.prototype, "redirect", function (target, statusCode = Core.HTTPStatus.TEMPORARY_REDIRECT) {
    if (this.headersSent) {
        throw new Exception_1.default(Errors_1.default.HEADERS_ALREADY_SENT, "Response headers were already sent.");
    }
    this.writeHead(statusCode, { "Location": target });
    return this;
});
extend(http.ServerResponse.prototype, "sendJSON", function (data) {
    if (this.finished) {
        throw new Exception_1.default(Errors_1.default.RESPONSE_ALREADY_CLOSED, "Response has been closed");
    }
    data = JSON.stringify(data);
    if (!this.headersSent) {
        this.setHeader("Content-Type", "application/json");
        this.setHeader("Content-Length", Buffer.byteLength(data));
    }
    this.end(data);
    return this;
});
extend(http.ServerResponse.prototype, "setCookie", function (...args) {
    if (this.headersSent) {
        throw new Exception_1.default(Errors_1.default.HEADERS_ALREADY_SENT, "Response headers were already sent.");
    }
    let cookieText;
    if (args.length === 1) {
        cookieText = this._cookiesDecoder.stringify(args[0]);
    }
    else {
        cookieText = this._cookiesDecoder.stringify({
            "name": args[0],
            "value": args[1],
            "ttl": args[2],
            "httpOnly": args[3],
            "secureOnly": args[4],
            "path": args[5],
            "domain": args[6]
        });
    }
    if (this.hasHeader("Set-Cookie")) {
        let cookies = this.getHeaders()["set-cookie"];
        cookies.push(cookieText);
        this.setHeader("Set-Cookie", cookies);
    }
    else {
        this.setHeader("Set-Cookie", [cookieText]);
    }
    return this;
});
//# sourceMappingURL=Response.js.map